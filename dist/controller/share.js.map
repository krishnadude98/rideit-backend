{"version":3,"sources":["../../src/controller/share.js"],"names":["config","db","api","post","req","res","newRide","ShareRide","from","body","to","date","time","vehicleno","vehiclemodel","eamount","save","err","send","json","message","get","find","shareRides","findById","params","id","shareRide","put","delete","remove","_id","share","messgae","advertisement","newReview","Review","title","text","shareride","review","reviews","push","newBidder","Bidder","userid","bid","bidder","bidders"],"mappings":"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","file":"share.js","sourcesContent":["import mongoose from 'mongoose';\nimport { Router } from 'express';\nimport ShareRide from '../model/share';\nimport Review from '../model/review';\nimport Bidder from '../model/bidder';\nimport bodyParser from 'body-parser';\n\nexport default({ config, db }) => {\n  let api = Router();\n  //CRUD Create Read Update Delete\n  // '/v1/restaurant/add'\n  api.post('/add', (req, res) => {\n    let newRide = new ShareRide();\n    newRide.from = req.body.from;\n    newRide.to = req.body.to;\n    newRide.date = req.body.date;\n    newRide.time = req.body.time;\n    newRide.vehicleno = req.body.vehicleno;\n    newRide.vehiclemodel = req.body.vehiclemodel;\n    newRide.eamount = req.body.eamount;\n\n    newRide.save(function(err) {\n      if (err) {\n        res.send(err);\n      }\n      res.json({ message: 'Advertisement added sucessfuly' });\n    });\n  });\n  //v1/share --Read\n  api.get('/',(req,res)=>{\n    ShareRide.find({},(err,shareRides)=>{\n      if(err){\n        res.send(err);\n      }\n      res.json(shareRides);\n    });\n  });\n\n  // v1/share/:id --Read 1\n  api.get('/:id',(req,res)=>{\n    ShareRide.findById(req.params.id,(err,shareRide)=>{\n      if(err){\n        res.send(err);\n      }\n      res.json(shareRide);\n    });\n  });\n  // v1/share/:id --Update\n  api.put('/:id',(req,res)=>{\n    ShareRide.findById(req.params.id,(err,shareRide)=>{\n      if(err){\n        res.send(err);\n      }\n      shareRide.from= req.body.from;\n      shareRide.to= req.body.to;\n      shareRide.date = req.body.date;\n      shareRide.time = req.body.time;\n      shareRide.vehicleno = req.body.vehicleno;\n      shareRide.vehiclemodel = req.body.vehiclemodel;\n      shareRide.eamount = req.body.eamount;\n\n      shareRide.save(err=>{\n        if(err){\n          res.send(err);\n        }\n        res.json({message:\"Advertisement info updated\"});\n      });\n    });\n  });\n\n  //v1/share/:// IDEA:\n    api.delete('/:id',(req,res)=>{\n      ShareRide.remove({\n        _id:req.params.id\n      },(err,share)=>{\n        if(err){\n          res.send(err);\n        }\n        res.json({messgae:\"Advertisement sucessfully removed\"});\n      });\n\n    });\n    //add review for particular Advertisement\n    //v1/reviews/add/:id is the path\n     api.post('/reviews/add/:id',(req,res)=>{\n        ShareRide.findById(req.params.id,(err,advertisement)=>{\n          if(err){\n            res.send(err);\n          }\n          let newReview= new Review();\n          newReview.title= req.body.title;\n          newReview.text= req.body.text;\n          newReview.shareride= advertisement._id;\n          newReview.save((err,review)=>{\n            if(err){\n              res.send(err);\n            }\n            advertisement.reviews.push(newReview);\n            advertisement.save(err=>{\n              if(err){\n                res.send(err);\n\n              }\n              res.json({message:\"Review Saved\"});\n            });\n          });\n        });\n     });\n     //get reviews for a particular /reviews/:id:\n      api.get('/reviews/:id',(req,res)=>{\n        Review.find({shareride:req.params.id},(err,reviews)=>{\n          if(err){\n            res.send(err);\n          }\n          res.json(reviews);\n        });\n      });\n\n      //add bidders for particular ad /bidders/added\n      api.post('/bidders/add/:id',(req,res)=>{\n        ShareRide.findById(req.params.id,(err,advertisement)=>{\n          if(err){\n            res.send(err);\n          }\n          let newBidder= new Bidder();\n          newBidder.userid= req.body.userid;\n          newBidder.bid= req.body.bid;\n          newBidder.shareride=advertisement._id;\n          newBidder.save((err,bidder)=>{\n            if(err){\n              res.send(err);\n            }\n            advertisement.bidders.push(newBidder);\n            advertisement.save(err=>{\n              if(err){\n                res.send(err);\n              }\n              res.json({message:\"Bidder added Sucessfully\"})\n            });\n          });\n\n        });\n      });\n\n\n  return api;\n}\n"]}